# तुमचा स्वतःचा SMTP मेल पाठवणारा सर्व्हर तयार करा

## प्रस्तावना

SMTP क्लाउड विक्रेत्यांकडून थेट सेवा खरेदी करू शकते, जसे की:

* [Amazon SES SMTP](https://docs.aws.amazon.com/ses/latest/dg/send-email-smtp.html)
* [अली मेघ ईमेल पुश](https://www.alibabacloud.com/help/directmail/latest/three-mail-sending-methods)

तुम्ही तुमचा स्वतःचा मेल सर्व्हर देखील तयार करू शकता - अमर्यादित पाठवणे, कमी एकूण खर्च.

खाली, आम्ही आमचा स्वतःचा मेल सर्व्हर कसा तयार करायचा ते चरण-दर-चरण दाखवतो.

## सर्व्हर निवड

सेल्फ-होस्टेड SMTP सर्व्हरला पोर्ट्स 25, 456, आणि 587 खुले असलेले सार्वजनिक IP आवश्यक आहे.

सामान्यतः वापरल्या जाणार्‍या सार्वजनिक ढगांनी ही पोर्ट डीफॉल्टनुसार अवरोधित केली आहेत आणि वर्क ऑर्डर जारी करून ते उघडणे शक्य आहे, परंतु हे खूप त्रासदायक आहे.

मी अशा होस्टकडून खरेदी करण्याची शिफारस करतो ज्यात हे पोर्ट खुले आहेत आणि रिव्हर्स डोमेन नेम सेट अप करण्यास समर्थन देतात.

येथे, मी [Contabo ची](https://contabo.com) शिफारस करतो.

Contabo म्युनिक, जर्मनी येथे स्थित एक होस्टिंग प्रदाता आहे, ज्याची स्थापना 2003 मध्ये अतिशय स्पर्धात्मक किमतींसह झाली.

तुम्ही खरेदीचे चलन म्हणून युरो निवडल्यास, किंमत स्वस्त होईल (8GB मेमरी आणि 4 CPUs असलेल्या सर्व्हरची किंमत प्रति वर्ष सुमारे 529 युआन आहे आणि प्रारंभिक स्थापना शुल्क एका वर्षासाठी विनामूल्य आहे).

![](https://pub-b8db533c86124200a9d799bf3ba88099.r2.dev/2023/03/UoAQkwY.webp)

ऑर्डर देताना, टिप्पणी `prefer AMD` , आणि AMD CPU सह सर्व्हरची कार्यक्षमता चांगली असेल.

खालील मध्ये, तुमचा स्वतःचा मेल सर्व्हर कसा तयार करायचा हे दाखवण्यासाठी मी Contabo चे VPS उदाहरण म्हणून घेईन.

## उबंटू सिस्टम कॉन्फिगरेशन

येथे ऑपरेटिंग सिस्टम उबंटू 22.04 आहे

![](https://pub-b8db533c86124200a9d799bf3ba88099.r2.dev/2023/03/smpIu1F.webp)

![](https://pub-b8db533c86124200a9d799bf3ba88099.r2.dev/2023/03/m7Mwjwr.webp)

ssh वर सर्व्हर दाखवत असल्यास `Welcome to TinyCore 13!` (खालील आकृतीत दर्शविल्याप्रमाणे), याचा अर्थ असा आहे की सिस्टम अद्याप स्थापित केलेली नाही. कृपया ssh डिस्कनेक्ट करा आणि पुन्हा लॉग इन करण्यासाठी काही मिनिटे प्रतीक्षा करा.

![](https://pub-b8db533c86124200a9d799bf3ba88099.r2.dev/2023/03/-qKACz9.webp)

जेव्हा `Welcome to Ubuntu 22.04.1 LTS` आहे, तेव्हा आरंभीकरण पूर्ण होते आणि तुम्ही पुढील चरणांसह पुढे चालू ठेवू शकता.

### [पर्यायी] विकास वातावरण सुरू करा

ही पायरी ऐच्छिक आहे.

सोयीसाठी, मी [github.com/wactax/ops.os/tree/main/ubuntu](https://github.com/wactax/ops.os/tree/main/ubuntu) मध्ये उबंटू सॉफ्टवेअरचे इंस्टॉलेशन आणि सिस्टम कॉन्फिगरेशन ठेवले आहे.

एका क्लिकवर इन्स्टॉल करण्यासाठी खालील कमांड चालवा.

```
bash <(curl -s https://raw.githubusercontent.com/wactax/ops.os/main/ubuntu/boot.sh)
```

चीनी वापरकर्ते, कृपया त्याऐवजी खालील आदेश वापरा आणि भाषा, वेळ क्षेत्र इ. आपोआप सेट होईल.

```
CN=1 bash <(curl -s https://ghproxy.com/https://raw.githubusercontent.com/wactax/ops.os/main/ubuntu/boot.sh)
```

### Contabo IPV6 सक्षम करते

IPV6 सक्षम करा जेणेकरून SMTP देखील IPV6 पत्त्यांसह ईमेल पाठवू शकेल.

संपादित करा `/etc/sysctl.conf`

खालील ओळी सुधारा किंवा जोडा

```
net.ipv6.conf.all.disable_ipv6 = 0
net.ipv6.conf.default.disable_ipv6 = 0
net.ipv6.conf.lo.disable_ipv6 = 0
```

[कॉन्टाबो ट्यूटोरियलचा पाठपुरावा करा: तुमच्या सर्व्हरवर IPv6 कनेक्टिव्हिटी जोडणे](https://contabo.com/blog/adding-ipv6-connectivity-to-your-server/)

संपादित करा `/etc/netplan/01-netcfg.yaml` , खालील आकृतीमध्ये दर्शविल्याप्रमाणे काही ओळी जोडा (Contabo VPS डीफॉल्ट कॉन्फिगरेशन फाइलमध्ये या ओळी आधीपासूनच आहेत, फक्त त्यांना अनकमेंट करा).

![](https://pub-b8db533c86124200a9d799bf3ba88099.r2.dev/2023/03/5MEi41I.webp)

नंतर सुधारित कॉन्फिगरेशन प्रभावी होण्यासाठी `netplan apply` .

कॉन्फिगरेशन यशस्वी झाल्यानंतर, तुम्ही तुमच्या बाह्य नेटवर्कचा ipv6 पत्ता पाहण्यासाठी `curl 6.ipw.cn` वापरू शकता.

## कॉन्फिगरेशन रेपॉजिटरी ऑप्स क्लोन करा

```
git clone https://github.com/wactax/ops.soft.git
```

## तुमच्या डोमेन नावासाठी मोफत SSL प्रमाणपत्र व्युत्पन्न करा

मेल पाठवताना कूटबद्धीकरण आणि स्वाक्षरीसाठी SSL प्रमाणपत्र आवश्यक आहे.

आम्ही प्रमाणपत्रे तयार करण्यासाठी [acme.sh](https://github.com/acmesh-official/acme.sh) वापरतो.

acme.sh हे ओपन सोर्स ऑटोमेटेड सर्टिफिकेट साइनिंग टूल आहे,

कॉन्फिगरेशन वेअरहाऊस ops.soft प्रविष्ट करा, `./ssl.sh` चालवा आणि **वरच्या निर्देशिकेत** एक `conf` फोल्डर तयार होईल.

[acme.sh dnsapi](https://github.com/acmesh-official/acme.sh/wiki/dnsapi) वरून तुमचा DNS प्रदाता शोधा, `conf/conf.sh` संपादित करा.

![](https://pub-b8db533c86124200a9d799bf3ba88099.r2.dev/2023/03/Qjq1C1i.webp)

नंतर तुमच्या डोमेन नावासाठी `123.com` आणि `*.123.com` प्रमाणपत्रे व्युत्पन्न करण्यासाठी `./ssl.sh 123.com` चालवा.

प्रथम रन स्वयंचलितपणे [acme.sh](https://github.com/acmesh-official/acme.sh) स्थापित करेल आणि स्वयंचलित नूतनीकरणासाठी शेड्यूल केलेले कार्य जोडेल. आपण `crontab -l` पाहू शकता, खालीलप्रमाणे अशी एक ओळ आहे.

```
52 0 * * * "/mnt/www/.acme.sh"/acme.sh --cron --home "/mnt/www/.acme.sh" > /dev/null
```

व्युत्पन्न प्रमाणपत्राचा मार्ग `/mnt/www/.acme.sh/123.com_ecc。`

प्रमाणपत्राचे नूतनीकरण `conf/reload/123.com.sh` स्क्रिप्टला कॉल करेल, ही स्क्रिप्ट संपादित करा, तुम्ही संबंधित अनुप्रयोगांचे प्रमाणपत्र कॅशे रिफ्रेश करण्यासाठी `nginx -s reload` सारख्या आदेश जोडू शकता.

## chasquid सह SMTP सर्व्हर तयार करा

[chasquid](https://github.com/albertito/chasquid) हा गो भाषेत लिहिलेला ओपन सोर्स SMTP सर्व्हर आहे.

पोस्टफिक्स आणि सेंडमेल सारख्या प्राचीन मेल सर्व्हर प्रोग्रामचा पर्याय म्हणून, चॅस्क्विड वापरण्यास सोपे आणि सोपे आहे आणि ते दुय्यम विकासासाठी देखील सोपे आहे.

रन `./chasquid/init.sh 123.com` एका क्लिकवर आपोआप स्थापित होईल (तुमच्या पाठवणाऱ्या डोमेन नावाने 123.com बदला).

## ईमेल स्वाक्षरी DKIM कॉन्फिगर करा

अक्षरे स्पॅम म्हणून हाताळली जाऊ नयेत यासाठी ईमेल स्वाक्षरी पाठवण्यासाठी DKIM चा वापर केला जातो.

कमांड यशस्वीरित्या चालल्यानंतर, तुम्हाला DKIM रेकॉर्ड सेट करण्यास सांगितले जाईल (खाली दर्शविल्याप्रमाणे).

![](https://pub-b8db533c86124200a9d799bf3ba88099.r2.dev/2023/03/LJWGsmI.webp)

तुमच्या DNS मध्ये फक्त TXT रेकॉर्ड जोडा (खाली दाखवल्याप्रमाणे).

![](https://pub-b8db533c86124200a9d799bf3ba88099.r2.dev/2023/03/0szKWqV.webp)

## सेवा स्थिती आणि नोंदी पहा

 `systemctl status chasquid` सेवा स्थिती पहा.

सामान्य ऑपरेशनची स्थिती खालील चित्रात दर्शविल्याप्रमाणे आहे

![](https://pub-b8db533c86124200a9d799bf3ba88099.r2.dev/2023/03/CAwyY4E.webp)

 `grep chasquid /var/log/syslog` किंवा `journalctl -xeu chasquid` त्रुटी लॉग पाहू शकतात.

## डोमेन नाव कॉन्फिगरेशन उलट करा

रिव्हर्स डोमेन नेम म्हणजे IP पत्ता संबंधित डोमेन नावावर सोडवण्याची परवानगी देणे.

रिव्हर्स डोमेन नेम सेट केल्याने ईमेल स्पॅम म्हणून ओळखले जाण्यापासून रोखू शकतात.

जेव्हा मेल प्राप्त होतो, तेव्हा प्राप्त करणारा सर्व्हर पाठवणार्‍या सर्व्हरकडे वैध रिव्हर्स डोमेन नाव आहे की नाही याची पुष्टी करण्यासाठी पाठवणार्‍या सर्व्हरच्या IP पत्त्यावर रिव्हर्स डोमेन नेम विश्लेषण करेल.

पाठवणार्‍या सर्व्हरकडे रिव्हर्स डोमेन नाव नसल्यास किंवा रिव्हर्स डोमेन नाव पाठवणार्‍या सर्व्हरच्या IP पत्त्याशी जुळत नसल्यास, प्राप्त करणारा सर्व्हर ईमेलला स्पॅम म्हणून ओळखू शकतो किंवा ते नाकारू शकतो.

[https://my.contabo.com/rdns ला](https://my.contabo.com/rdns) भेट द्या आणि खाली दाखवल्याप्रमाणे कॉन्फिगर करा

![](https://pub-b8db533c86124200a9d799bf3ba88099.r2.dev/2023/03/IIPdBk_.webp)

रिव्हर्स डोमेन नेम सेट केल्यानंतर, सर्व्हरवर डोमेन नाव ipv4 आणि ipv6 चे फॉरवर्ड रिझोल्यूशन कॉन्फिगर करण्याचे लक्षात ठेवा.

## chasquid.conf चे होस्टनाव संपादित करा

`conf/chasquid/chasquid.conf` रिव्हर्स डोमेन नावाच्या मूल्यामध्ये बदला.

![](https://pub-b8db533c86124200a9d799bf3ba88099.r2.dev/2023/03/6Fw4SQi.webp)

नंतर सेवा रीस्टार्ट करण्यासाठी `systemctl restart chasquid` चालवा.

## git रेपॉजिटरीमध्ये conf चा बॅकअप घ्या

![](https://pub-b8db533c86124200a9d799bf3ba88099.r2.dev/2023/03/Fier9uv.webp)

उदाहरणार्थ, मी conf फोल्डरचा बॅकअप माझ्या स्वतःच्या गिथब प्रक्रियेत खालीलप्रमाणे करतो

प्रथम खाजगी गोदाम तयार करा

![](https://pub-b8db533c86124200a9d799bf3ba88099.r2.dev/2023/03/ZSCT1t1.webp)

conf निर्देशिका प्रविष्ट करा आणि वेअरहाऊसमध्ये सबमिट करा

```
git init
git add .
git commit -m "init"
git branch -M main
git remote add origin git@github.com:wac-tax-key/conf.git
git push -u origin main
```

## प्रेषक जोडा

धावणे

```
chasquid-util user-add i@wac.tax
```

प्रेषक जोडू शकता

![](https://pub-b8db533c86124200a9d799bf3ba88099.r2.dev/2023/03/khHjLof.webp)

### पासवर्ड योग्यरित्या सेट केला आहे याची खात्री करा

```
chasquid-util authenticate i@wac.tax --password=xxxxxxx
```

![](https://pub-b8db533c86124200a9d799bf3ba88099.r2.dev/2023/03/e92JHXq.webp)

वापरकर्ता जोडल्यानंतर, `chasquid/domains/wac.tax/users` अपडेट केले जातील, ते वेअरहाऊसमध्ये सबमिट करण्याचे लक्षात ठेवा.

## DNS SPF रेकॉर्ड जोडा

SPF (प्रेषक धोरण फ्रेमवर्क) हे ईमेल फसवणूक रोखण्यासाठी वापरले जाणारे ईमेल सत्यापन तंत्रज्ञान आहे.

प्रेषकाचा IP पत्ता तो असल्याचा दावा करत असलेल्या डोमेन नावाच्या DNS रेकॉर्डशी जुळतो हे तपासून मेल पाठवणाऱ्याची ओळख पडताळते, फसवणूक करणाऱ्यांना बोगस ईमेल पाठवण्यापासून प्रतिबंधित करते.

SPF रेकॉर्ड जोडणे शक्य तितके ईमेल स्पॅम म्हणून ओळखले जाण्यापासून रोखू शकते.

तुमचा डोमेन नेम सर्व्हर SPF प्रकाराला सपोर्ट करत नसल्यास, फक्त TXT प्रकार रेकॉर्ड जोडा.

उदाहरणार्थ, `wac.tax` चा SPF खालीलप्रमाणे आहे

`v=spf1 a mx include:_spf.wac.tax include:_spf.google.com ~all`

`_spf.wac.tax` साठी SPF

`v=spf1 a:smtp.wac.tax ~all`

लक्षात घ्या की मी येथे `include:_spf.google.com` , याचे कारण मी नंतर Google मेलबॉक्समध्ये पाठवण्याचा पत्ता म्हणून `i@wac.tax` कॉन्फिगर करेन.

## DNS कॉन्फिगरेशन DMARC

DMARC हे (डोमेन-आधारित मेसेज ऑथेंटिकेशन, रिपोर्टिंग आणि कॉन्फॉर्मन्स) चे संक्षिप्त रूप आहे.

हे SPF बाऊन्स कॅप्चर करण्यासाठी वापरले जाते (कदाचित कॉन्फिगरेशन त्रुटींमुळे किंवा कोणीतरी स्पॅम पाठवण्यासाठी तुम्ही असल्याचे भासवत असेल).

TXT रेकॉर्ड `_dmarc` जोडा,

सामग्री खालीलप्रमाणे आहे

```
v=DMARC1; p=quarantine; fo=1; ruf=mailto:ruf@wac.tax; rua=mailto:rua@wac.tax
```

![](https://pub-b8db533c86124200a9d799bf3ba88099.r2.dev/2023/03/k44P7O3.webp)

प्रत्येक पॅरामीटरचा अर्थ खालीलप्रमाणे आहे

### p (धोरण)

SPF (प्रेषक धोरण फ्रेमवर्क) किंवा DKIM (DomainKeys आयडेंटिफाइड मेल) पडताळणी अयशस्वी होणारे ईमेल कसे हाताळायचे ते सूचित करते. p पॅरामीटर तीनपैकी एका मूल्यावर सेट केले जाऊ शकते:

* काहीही नाही: कोणतीही कारवाई केली जात नाही, फक्त पडताळणी परिणाम ईमेल रिपोर्टिंग यंत्रणेद्वारे प्रेषकाला परत दिला जातो.
* क्वारंटाइन: ज्या मेलने पडताळणी केली नाही ती स्पॅम फोल्डरमध्ये ठेवा, परंतु मेल थेट नाकारणार नाही.
* reject: पडताळणी अयशस्वी ईमेल थेट नाकारणे.

### fo (अयशस्वी पर्याय)

रिपोर्टिंग यंत्रणेद्वारे परत केलेल्या माहितीचे प्रमाण निर्दिष्ट करते. हे खालीलपैकी एका मूल्यावर सेट केले जाऊ शकते:

* 0: सर्व संदेशांसाठी प्रमाणीकरण परिणामांचा अहवाल द्या
* 1: केवळ सत्यापन अयशस्वी झालेल्या संदेशांची तक्रार करा
* d: फक्त डोमेन नाव पडताळणी अयशस्वी झाल्याची तक्रार करा
* s: फक्त SPF पडताळणी अयशस्वी झाल्याची तक्रार करा
* l: फक्त DKIM पडताळणी अयशस्वी झाल्याची तक्रार करा

### रुआ आणि रुफ

* rua (एकत्रित अहवालांसाठी URI अहवाल देणे): एकत्रित अहवाल प्राप्त करण्यासाठी ईमेल पत्ता
* ruf (फॉरेन्सिक अहवालांसाठी URI रिपोर्टिंग): तपशीलवार अहवाल प्राप्त करण्यासाठी ईमेल पत्ता

## Google Mail वर ईमेल फॉरवर्ड करण्यासाठी MX रेकॉर्ड जोडा

सार्वत्रिक पत्त्यांचे समर्थन करणारा विनामूल्य कॉर्पोरेट मेलबॉक्स मला सापडला नाही (कॅच-ऑल, या डोमेन नावावर पाठवलेले कोणतेही ईमेल, उपसर्गावरील निर्बंधांशिवाय प्राप्त करू शकतात), मी माझ्या Gmail मेलबॉक्समध्ये सर्व ईमेल फॉरवर्ड करण्यासाठी चॅस्किडचा वापर केला.

**तुमचा स्वतःचा सशुल्क व्यवसाय मेलबॉक्स असल्यास, कृपया MX मध्ये बदल करू नका आणि ही पायरी वगळा.**

`conf/chasquid/domains/wac.tax/aliases` संपादित करा, फॉरवर्डिंग मेलबॉक्स सेट करा

![](https://pub-b8db533c86124200a9d799bf3ba88099.r2.dev/2023/03/OBDl2gw.webp)

`*` सर्व ईमेल सूचित करते, `i` वर तयार केलेल्या पाठवणार्‍या वापरकर्त्याचा ईमेल पत्ता उपसर्ग आहे. मेल फॉरवर्ड करण्यासाठी, प्रत्येक वापरकर्त्याने एक ओळ जोडणे आवश्यक आहे.

नंतर MX रेकॉर्ड जोडा (खालील चित्रात पहिल्या ओळीत दर्शविल्याप्रमाणे मी येथे थेट उलट डोमेन नावाच्या पत्त्याकडे निर्देश करतो).

![](https://pub-b8db533c86124200a9d799bf3ba88099.r2.dev/2023/03/7__KrU8.webp)

कॉन्फिगरेशन पूर्ण झाल्यानंतर, तुम्ही Gmail मध्ये ईमेल प्राप्त करू शकता का हे पाहण्यासाठी `i@wac.tax` आणि `any123@wac.tax` वर ईमेल पाठवण्यासाठी तुम्ही इतर ईमेल पत्ते वापरू शकता.

नसल्यास, chasquid log ( `grep chasquid /var/log/syslog` ) तपासा.

## Google Mail सह i@wac.tax वर ईमेल पाठवा

Google Mail ला मेल प्राप्त झाल्यानंतर, मला स्वाभाविकपणे i.wac.tax@gmail.com ऐवजी `i@wac.tax` ने उत्तर देण्याची आशा होती.

[https://mail.google.com/mail/u/1/#settings/accounts](https://mail.google.com/mail/u/1/#settings/accounts) ला भेट द्या आणि "दुसरा ईमेल पत्ता जोडा" वर क्लिक करा.

![](https://pub-b8db533c86124200a9d799bf3ba88099.r2.dev/2023/03/PAvyE3C.webp)

![](https://pub-b8db533c86124200a9d799bf3ba88099.r2.dev/2023/03/_OgLsPT.webp)

![](https://pub-b8db533c86124200a9d799bf3ba88099.r2.dev/2023/03/XIUf6Dc.webp)

त्यानंतर, अग्रेषित केलेल्या ईमेलद्वारे प्राप्त केलेला सत्यापन कोड प्रविष्ट करा.

शेवटी, तो डिफॉल्ट प्रेषकाचा पत्ता म्हणून सेट केला जाऊ शकतो (त्याच पत्त्यासह उत्तर देण्याच्या पर्यायासह).

![](https://pub-b8db533c86124200a9d799bf3ba88099.r2.dev/2023/03/a95dO60.webp)

अशा प्रकारे, आम्ही SMTP मेल सर्व्हरची स्थापना पूर्ण केली आहे आणि त्याच वेळी ईमेल पाठवण्यासाठी आणि प्राप्त करण्यासाठी Google Mail चा वापर करू.

## कॉन्फिगरेशन यशस्वी झाले आहे की नाही हे तपासण्यासाठी चाचणी ईमेल पाठवा

`ops/chasquid` एंटर करा

डिरेनव्हला अवलंबित्व स्थापित करण्याची `direnv allow` (मागील वन-की इनिशिएलायझेशन प्रक्रियेत direnv स्थापित केले गेले आहे आणि शेलमध्ये एक हुक जोडला गेला आहे)

नंतर धाव

```
user=i@wac.tax pass=xxxx to=iuser.link@gmail.com ./sendmail.coffee
```

पॅरामीटर्सचा अर्थ खालीलप्रमाणे आहे

* वापरकर्ता: SMTP वापरकर्तानाव
* पास: SMTP पासवर्ड
* ते: प्राप्तकर्ता

तुम्ही चाचणी ईमेल पाठवू शकता.

![](https://pub-b8db533c86124200a9d799bf3ba88099.r2.dev/2023/03/ae1iWyM.webp)

कॉन्फिगरेशन यशस्वी आहेत की नाही हे तपासण्यासाठी चाचणी ईमेल प्राप्त करण्यासाठी Gmail वापरण्याची शिफारस केली जाते.

### TLS मानक एन्क्रिप्शन

खालील आकृतीत दाखवल्याप्रमाणे, हे लहान लॉक आहे, याचा अर्थ SSL प्रमाणपत्र यशस्वीरित्या सक्षम केले गेले आहे.

![](https://pub-b8db533c86124200a9d799bf3ba88099.r2.dev/2023/03/SrdbAwh.webp)

नंतर "मूळ ईमेल दर्शवा" वर क्लिक करा

![](https://pub-b8db533c86124200a9d799bf3ba88099.r2.dev/2023/03/qQQsdxg.webp)

### DKIM

खालील चित्रात दाखवल्याप्रमाणे, Gmail मूळ मेल पेज DKIM दाखवते, याचा अर्थ DKIM कॉन्फिगरेशन यशस्वी झाले आहे.

![](https://pub-b8db533c86124200a9d799bf3ba88099.r2.dev/2023/03/an6aXK6.webp)

मूळ ईमेलच्या शीर्षलेखात प्राप्त झालेले तपासा, आणि आपण पाहू शकता की प्रेषकाचा पत्ता IPV6 आहे, याचा अर्थ IPV6 देखील यशस्वीरित्या कॉन्फिगर झाला आहे.
